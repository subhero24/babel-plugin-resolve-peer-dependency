{"version":3,"file":"index.es.js","sources":["../src/index.js"],"sourcesContent":["import Path from 'path';\nimport Resolve from 'resolve-from';\nimport Filesystem from 'fs';\n\nconst transform = (plugin, dependency) => {\n\tif (plugin.cwd === process.cwd()) {\n\t\treturn dependency;\n\t} else {\n\t\tlet packageFilename = Path.join(plugin.cwd, 'package.json');\n\t\tif (Filesystem.existsSync(packageFilename)) {\n\t\t\tlet packageJSON = require(packageFilename);\n\t\t\tlet peerDependencies = packageJSON.peerDependencies || {};\n\t\t\tfor (let peerDependency in peerDependencies) {\n\t\t\t\tif (dependency === peerDependency || dependency.startsWith(peerDependency + '/')) {\n\t\t\t\t\tlet localDependency = Resolve.silent(process.cwd(), dependency);\n\t\t\t\t\tif (localDependency == undefined) {\n\t\t\t\t\t\tconsole.warn(\n\t\t\t\t\t\t\t`Peerdependency '${peerDependency}' was not found in main package. '${dependency}' will not be resolved.`,\n\t\t\t\t\t\t);\n\t\t\t\t\t\treturn dependency;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlet relativeRoot = Path.relative(plugin.cwd, process.cwd());\n\t\t\t\t\t\tlet relativeLocalDependency = Path.relative(process.cwd(), localDependency);\n\t\t\t\t\t\tlet relativeDependency = Path.join(relativeRoot, relativeLocalDependency);\n\n\t\t\t\t\t\tconsole.log(\n\t\t\t\t\t\t\t`The dependency '${dependency}' was specified as a peerDependency in ${\n\t\t\t\t\t\t\t\tpackageJSON.name\n\t\t\t\t\t\t\t}. Transforming it to ${relativeDependency} to use package '${dependency}' from the project in the current working directory`,\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\treturn relativeDependency;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn dependency;\n\t}\n};\n\nconst Plugin = ({ types }) => {\n\tconst traverseExpression = (type, arg) => {\n\t\tif (type.isStringLiteral(arg)) {\n\t\t\treturn arg;\n\t\t}\n\n\t\tif (type.isBinaryExpression(arg)) {\n\t\t\treturn traverseExpression(type, arg.left);\n\t\t}\n\n\t\treturn null;\n\t};\n\n\tconst visitor = {\n\t\tCallExpression(path) {\n\t\t\tif (path.node.callee.name === 'require' || path.node.callee.type === 'Import') {\n\t\t\t\tconst args = path.node.arguments;\n\t\t\t\tif (!args.length) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst firstArg = traverseExpression(types, args[0]);\n\t\t\t\tif (firstArg) {\n\t\t\t\t\tfirstArg.value = transform(this, firstArg.value);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tImportDeclaration(path) {\n\t\t\tpath.node.source.value = transform(this, path.node.source.value);\n\t\t},\n\t\tExportNamedDeclaration(path) {\n\t\t\tif (path.node.source) {\n\t\t\t\tpath.node.source.value = transform(this, path.node.source.value);\n\t\t\t}\n\t\t},\n\t\tExportAllDeclaration(path) {\n\t\t\tif (path.node.source) {\n\t\t\t\tpath.node.source.value = transform(this, path.node.source.value);\n\t\t\t}\n\t\t},\n\t};\n\treturn {\n\t\tvisitor: {\n\t\t\tProgram(path) {\n\t\t\t\tpath.traverse(visitor, this);\n\t\t\t},\n\t\t},\n\t};\n};\n\nexport default Plugin;\n"],"names":["transform","plugin","dependency","cwd","process","packageFilename","Path","join","Filesystem","existsSync","packageJSON","require","peerDependencies","peerDependency","startsWith","localDependency","Resolve","silent","undefined","console","warn","relativeRoot","relative","relativeLocalDependency","relativeDependency","log","name","types","traverseExpression","type","arg","isStringLiteral","isBinaryExpression","left","visitor","CallExpression","path","node","callee","args","arguments","length","firstArg","value","this","ImportDeclaration","source","ExportNamedDeclaration","ExportAllDeclaration","Program","traverse"],"mappings":"oFAIA,MAAMA,UAAY,CAACC,OAAQC,iBACtBD,OAAOE,MAAQC,QAAQD,aACnBD,WACD,KACFG,gBAAkBC,KAAKC,KAAKN,OAAOE,IAAK,mBACxCK,WAAWC,WAAWJ,iBAAkB,KACvCK,YAAcC,QAAQN,iBACtBO,iBAAmBF,YAAYE,kBAAoB,OAClD,IAAIC,kBAAkBD,oBACtBV,aAAeW,gBAAkBX,WAAWY,WAAWD,eAAiB,KAAM,KAC7EE,gBAAkBC,QAAQC,OAAOb,QAAQD,MAAOD,eAC7BgB,MAAnBH,uBACHI,QAAQC,wBACYP,mDAAmDX,qCAEhEA,WACD,KACFmB,aAAef,KAAKgB,SAASrB,OAAOE,IAAKC,QAAQD,OACjDoB,wBAA0BjB,KAAKgB,SAASlB,QAAQD,MAAOY,iBACvDS,mBAAqBlB,KAAKC,KAAKc,aAAcE,gCAEjDJ,QAAQM,uBACYvB,oDAClBQ,YAAYgB,4BACWF,sCAAsCtB,iEAGxDsB,4BAMJtB,2BAIM,EAAGyB,MAAAA,gBACXC,mBAAqB,CAACC,KAAMC,MAC7BD,KAAKE,gBAAgBD,KACjBA,IAGJD,KAAKG,mBAAmBF,KACpBF,mBAAmBC,KAAMC,IAAIG,MAG9B,KAGFC,QAAU,CACfC,eAAeC,SACgB,YAA1BA,KAAKC,KAAKC,OAAOZ,MAAgD,WAA1BU,KAAKC,KAAKC,OAAOT,KAAmB,OACxEU,KAAOH,KAAKC,KAAKG,cAClBD,KAAKE,oBAIJC,SAAWd,mBAAmBD,MAAOY,KAAK,IAC5CG,WACHA,SAASC,MAAQ3C,UAAU4C,KAAMF,SAASC,UAI7CE,kBAAkBT,MACjBA,KAAKC,KAAKS,OAAOH,MAAQ3C,UAAU4C,KAAMR,KAAKC,KAAKS,OAAOH,QAE3DI,uBAAuBX,MAClBA,KAAKC,KAAKS,SACbV,KAAKC,KAAKS,OAAOH,MAAQ3C,UAAU4C,KAAMR,KAAKC,KAAKS,OAAOH,SAG5DK,qBAAqBZ,MAChBA,KAAKC,KAAKS,SACbV,KAAKC,KAAKS,OAAOH,MAAQ3C,UAAU4C,KAAMR,KAAKC,KAAKS,OAAOH,gBAItD,CACNT,QAAS,CACRe,QAAQb,MACPA,KAAKc,SAAShB,QAASU"}